{% extends 'base.html' %}
{% block css_url %}

{% endblock css_url %}

{% block content %}
{% for ak in area %}
    {{ak.area_longitude}}
    {{ak.area_latitude}}
{% endfor %}

<!-- {{area.area_longitude}} -->
<div class="flex justify-center w-full">
    <div class="w-4/5">
        <div id="content-header" class="w-full bg-header-predictions-color rounded-md p-6 mb-8">
            <h1 class="text-2xl font-bold font-predictions-color-header">Hasil Prediksi Data Manual</h1>
            <!-- <p class="text-slate-50 mt-3 text-sm">Lorem ipsum dolor sit amet consectetur adipisicing elit. Ea, nesciunt.
            </p> -->
        </div>
        <div class="overflow-x-auto shadow-md sm:rounded-lg px-5 py-3">
            <table class="w-full text-sm text-left rtl:text-right text-gray-500">
                <thead
                    class="text-xs text-center text-white uppercase bg-primary-color dark:bg-gray-700 dark:text-gray-400">
                    <tr id="tr-thead">
                    </tr>
                </thead>
                <tbody class="text-center" id="tbody">

                </tbody>
            </table>
        </div>
        <!-- bar chart -->
        <div class="flex items-center">
            <div class="w-4/5">
                <img src="data:image/png;base64,{{img}}" alt="">
            </div>
            <div class="flex flex-col justify-center">
                <div class="flex flex-col items-center">
                    <h3>Total Label <span class="font-bold">"Cocok"</span></h3>
                    <h1 class="font-bold text-lg">{{nilai_cocok}}</h1>
                </div>

                <div class="flex flex-col items-center">
                    <h3>Total Label <span class="font-bold">"Tidak Cocok"</span></h3>
                    <h1 class="font-bold text-lg">{{nilai_tidak}}</h1>
                </div>
            </div>
        </div>

        <!-- peta sebaran -->
        <div class="flex justify-center mt-10">
            <h1 class="text-2xl font-semibold font-predictions-color-header">Peta Sebaran Prediksi</h1>
        </div>
        <div id="map" class="w-72 h-72">

        </div>
    </div>
</div>

<script>
    var data_test = JSON.parse('{{ data_test | safe }}');
    var data_send = JSON.stringify(data_test);
    const tbody = document.getElementById('tbody');
    const tr_thead = document.getElementById('tr-thead');
    const columns = ['area','hum', 'soil_nitro1', 'soil_phos1', 'soil_pot1', 'soil_temp1', 'soil_ph1', 'temp',
        'Nilai Prediksi']
    
    for(let i = 0; i < columns.length; i++) {
        var th = document.createElement('th');
        th.setAttribute('scope', 'col')
        th.setAttribute('class', 'px-6 py-3');
        th.innerHTML = columns[i];
        tr_thead.appendChild(th);
    }
    
    for (property in data_test) {
        data = data_test[property]
        const tr_body = document.createElement('tr');
        tr_body.setAttribute('class', 'bg-white border-b');
        id_m = data['id_m'];
        // console.log(`Ini adalah ${id_m}`)
        for (item in data) {
            tbody.appendChild(tr_body);
            if (item != 'id_m') {
                if (item == 'area') {
                    const td = document.createElement('td');
                    const a = document.createElement('a');
                    td.setAttribute('class', 'px-6 py-4 whitespace-nowrap');
                    a.setAttribute('href', `/land_predict/add-manual-data/add-area/${id_m}`);
                    a.setAttribute('class', 'font-bold hover:text-primary-color-dark');
                    a.innerText = data[item];
                    td.appendChild(a);
                    tr_body.appendChild(td);
                    continue;
                }
                
                const td = document.createElement('td');
                td.setAttribute('class', 'px-6 py-4 whitespace-nowrap');
                td.innerText = data[item];
                tr_body.appendChild(td);

                // console.log(data[item]);
                // console.log(item, data[item]);
                if (data[item] == 'Tidak') {
                    td.setAttribute('class', 'px-6 py-4 whitespace-nowrap text-red-500');
                }
                if (data[item] == 'Cocok'){ 
                    td.setAttribute('class', 'px-6 py-4 whitespace-nowrap text-green-500');
                }
            }
        }
    }
    
    // maps sebaran
    var area = JSON.parse('{{ area | safe }}');
    const map = L.map('map').setView([area[0].area_latitude, area[0].area_longitude], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);
    
    
    for (let i = 0; i < area.length; i++) {
        // var marker = L.marker([area[i].area_latitude, area[i].area_longitude]).addTo(map);
        // marker.bindPopup(`<b>${area[i].area_name}</b><br>${area[i].area_address}`).closePopup();
        console.log(area[i].area_latitude, area[i].area_longitude);
        var marker = L.marker([area[i].area_latitude, area[i].area_longitude]).addTo(map);
    }
    // var marker = L.marker([-6.972255036543781, 107.63149332507452]).addTo(map);
    // var marker2 = L.marker([-6.974683115485118, 107.63681482713721]).addTo(map);
    // marker.bindPopup("<b>Hello world!</b><br>I am a popup.").closePopup();
</script>
{% endblock content %}